/* 
This is the master do file for re-producing all results in the paper using CA30 as the HF measure.

RA: WWZ 
Time: 2025-04-14
*/

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? step 1. default setups
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

version 16

clear all
set more off
set maxvar 32767
set varabbrev off

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? step 2. global macros to store folder paths
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

if  "`c(username)'" == "virginiaminni" global user "/Users/virginiaminni/Dropbox/JMP_Managers"
if 	"`c(username)'" == "virginia_m"    global user "C:/Users/virginia_m/Dropbox/JMP_Managers"
if	"`c(username)'" == "wang"          global user "E:/__RA/02MANAGERS"

cd "${user}"

global Paper        "${user}/Paper Managers"
global DoFiles      "${user}/Paper Managers/DoFiles"
global Results      "${user}/Paper Managers/Results"

global FinalData    "${user}/Paper Managers/Data"
global RawMNEData   "${user}/Paper Managers/Data/01RawData/01MNEData"
global RawONETData  "${user}/Paper Managers/Data/01RawData/02ONET"
global RawCntyData  "${user}/Paper Managers/Data/01RawData/03Country"
global TempData     "${user}/Paper Managers/Data/02TempData"

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? step 3. libraries (user-written procedures) to be used 
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?
*-? install all necessary packages to a local directory
*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?

/* do "${DoFiles}/01Main/0001InstallPackages.do" */

*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?
*-? using libraries stored in the local Libraries folder
*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?

net set ado "${DoFiles}/Libraries"

tokenize `"$S_ADO"', parse(";")
while `"`1'"' != "" {
    if `"`1'"'!="BASE" capture adopath - `"`1'"'
    macro shift
}
adopath ++ "${DoFiles}/Libraries"

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? step 4. set figure scheme 
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

grstyle init white_tableau, path("${DoFiles}/Libraries") replace
grstyle set plain, horizontal grid

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? step 5. replicate results in the paper
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

global if_erase_temp_file = 1
    //&? if it is set to 1, temporary auxiliary dta files produced in the data cleaning process will be erased

*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?
*-? s-5-1. dataset construction
*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?

/* capture log close 
log using "${TempData}/log20250421_DataCleaningWithCA30.txt", replace text

do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0101_01GenerateWorkersOutcomes.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0101_02ONETRawScoreConstruction.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0101_03ONETPercentileRankConstruction.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0102_01UpdateVarAgeBand.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0102_02GenerateVarAgeContinuous.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0102_03GenerateVarHFMeasure.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0103_01IdentifyEventWorkers.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0103_02GenerateEventDummies.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0103_03GenerateOtherOutcomes.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0104GenerateHeterogeneityIndicators.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0105SalesProductivityDatasets.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0106TeamLevelDataset.do"

log close */

*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?
*-? s-5-2. quarterly aggregation programs
*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?

do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0201CoefPrograms_LHminusLL.do" 
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0202CoefPrograms_HLminusHH.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0203CoefPrograms_Dual_TestingforAsymmetries.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0204CoefPrograms_LHminusLL_OnlyPost.do" 
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0205CoefPrograms_HLminusHH_OnlyPost.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0206CoefPrograms_Dual_TestingforAsymmetries_OnlyPost.do"
do "${DoFiles}/03Exploration/21FullResultsWithCA30Measure/0207CoefPrograms_CohortDynamics.do"
