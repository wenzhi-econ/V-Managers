/* 
This do file compares H- and L-type managers in active learning activities.

Input:
    "${TempData}/FinalAnalysisSample.dta" <== created in 0103_03 do file 
    "${RawMNEData}/ActiveLearn.dta"       <== raw data 

Results:
    "${Results}/FTActiveLearn.tex"

RA: WWZ 
Time: 2025-04-16
*/

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? step 1. obtain variables about workers' active learning in the firm
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

use "${TempData}/FinalAnalysisSample.dta", clear 
    //impt: use the analysis sample, i.e., keep only those workers who are in the event studies

*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?
*-? s-1-1. obtain variables about active learning 
*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?

merge 1:1 IDlse YearMonth using "${RawMNEData}/ActiveLearn.dta"
    keep if _merge==3
    drop _merge  

*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?
*-? s-1-2. keep only relevant variables  
*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?

keep if CA30_LtoL==1 | CA30_LtoH==1
    //impt: keep only LtoL and LtoH event workers

sort IDlse YearMonth
keep Year YearMonth IDlse Event_Time Rel_Time Post_Event ///
    CA30_LtoL CA30_LtoH IDMngr_Post ///
    Func Office Country Female AgeBand ///
    NumRecommend NumCompleted NumSkills

replace  NumRecommend  = 0 if NumRecommend==.
replace  NumCompleted  = 0 if NumCompleted==.
replace  NumSkills     = 0 if NumSkills   ==.

keep if Post_Event==1
    //impt: keep only post-event observations 

*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?
*-? s-1-3. collapse into employee-year level  
*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?*-?

sort IDlse YearMonth

collapse ///
    (mean) Event_Time CA30_LtoL CA30_LtoH IDMngr_Post ///
    (last) Func Office Country Female AgeBand ///
    (max) NumRecommend NumCompleted NumSkills ///
    (max) Post_Event Max_Rel_Time=Rel_Time ///
    (min) Min_Rel_Time = Rel_Time, by(IDlse Year)

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? step 2. outcome 1: raw yearly value  
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

regress NumRecommend CA30_LtoH, vce(robust) // -2.246726
regress NumCompleted CA30_LtoH, vce(robust) // -.0605712
regress NumSkills    CA30_LtoH, vce(robust) // .9534601**

reghdfe NumRecommend CA30_LtoH, absorb(Year Func#Office Female#AgeBand) vce(robust) // -8.089739
reghdfe NumCompleted CA30_LtoH, absorb(Year Func#Office Female#AgeBand) vce(robust) // .0438454
reghdfe NumSkills    CA30_LtoH, absorb(Year Func#Office Female#AgeBand) vce(robust) // .6045353**

reghdfe NumRecommend CA30_LtoH, absorb(Year Country) vce(robust) // -3.0285
reghdfe NumCompleted CA30_LtoH, absorb(Year Country) vce(robust) // -.4098037
reghdfe NumSkills    CA30_LtoH, absorb(Year Country) vce(robust) // .6839642**

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? step 3. outcome 2: yearly binary outcomes  
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

summarize NumRecommend if Post_Event==0, detail 
summarize NumCompleted if Post_Event==0, detail 
summarize NumSkills    if Post_Event==0, detail 

capture drop NumRecommendB NumCompletedB NumSkillsB
generate NumRecommendB = (NumRecommend>0)
generate NumCompletedB = (NumCompleted>=5)
generate NumSkillsB    = (NumSkills>=3)

reghdfe NumRecommendB CA30_LtoH, absorb(Year Func#Office Female#AgeBand) cluster(IDMngr_Post) // .0013992
reghdfe NumCompletedB CA30_LtoH, absorb(Year Func#Office Female#AgeBand) cluster(IDMngr_Post) // -.0041289
reghdfe NumSkillsB    CA30_LtoH, absorb(Year Func#Office Female#AgeBand) cluster(IDMngr_Post) // .0115458
