/* 
This do file combines workers' outcomes and a set of event dummies.

It also compares self-constructed variables with those in the original dataset in step 2 and step 3 code blocks, which can be completely commented out.

RA: WWZ 
Time: 2024-10-08
*/

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? step 1. self-constructed dataset 
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

use "${TempData}/01WorkersOutcomes.dta", clear 

merge 1:1 IDlse YearMonth using "${TempData}/02EventStudyDummies.dta", generate(_merge_outcome_eventdummies)

order IDlse YearMonth IDlseMHR EarlyAgeM ///
    FT_Rel_Time FT_Mngr_both_WL2 FT_LtoL FT_LtoH FT_HtoH FT_HtoL FT_Never_ChangeM ///
    TransferSJVC TransferFuncC LogPayBonus LogPay LogBonus ChangeSalaryGradeC ///
    StandardJob Func SalaryGrade Office SubFunc Org4 OfficeCode Pay Bonus Benefit Package

/* drop if _merge_outcome_eventdummies == 1 */
    //&? No event information, mostly likely because missing manager id. 

save "${TempData}/03MainOutcomesInEventStudies.dta", replace

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? step 2. original dataset for comparison 
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

use "${FinalData}/AllSameTeam2.dta", clear 


keep ///
    IDlse YearMonth IDlseMHR EarlyAgeM ///
    WL2 ///
    FTHL FTLL FTHH FTLH ///
    TransferSJVC LogPayBonus LogPay LogBonus ChangeSalaryGradeC

foreach var in IDlseMHR EarlyAgeM WL2 FTHL FTLL FTHH FTLH TransferSJVC LogPayBonus LogPay LogBonus ChangeSalaryGradeC {
    rename `var' `var'_ORI 
}

label drop _all 

save "${TempData}/test_OriginalOutcomesAndEventDummies.dta", replace 

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? step 3. compare key variables original vs self-constructed dataset
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

use "${TempData}/03MainOutcomesInEventStudies.dta", clear

merge 1:1 IDlse YearMonth using "${TempData}/test_OriginalOutcomesAndEventDummies.dta", generate(_merge_test)

order IDlse YearMonth ///
    IDlseMHR IDlseMHR_ORI ///
    EarlyAgeM EarlyAgeM_ORI ///
    FT_Mngr_both_WL2 WL2_ORI ///
    FT_Calend_Time_LtoL FTLL_ORI ///
    FT_Calend_Time_LtoH FTLH_ORI ///
    FT_Calend_Time_HtoH FTHH_ORI ///
    FT_Calend_Time_HtoL FTHL_ORI ///
    TransferSJVC TransferSJVC_ORI ///
    LogPayBonus LogPayBonus_ORI ///
    ChangeSalaryGradeC ChangeSalaryGradeC_ORI

save "${TempData}/test_OriginalVSSelfConstructedEventDummies.dta", replace
