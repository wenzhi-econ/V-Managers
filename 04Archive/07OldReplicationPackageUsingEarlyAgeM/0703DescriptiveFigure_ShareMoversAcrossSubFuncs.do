/* 
This do file plots the average monthly move rates across subfunctions.

Input:
    "${TempData}/04MainOutcomesInEventStudies.dta" <== created in 0104 do file 

Results:
    "${Results}/AvgLateralMoveRatesAcrossSubfunctions.pdf"
    "${Results}/AvgSalaryGradeIncreaseRatesAcrossSubfunctions.pdf"

RA: WWZ 
Time: 2024-12-06
*/

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? step 1. collapse into subfunction level data
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

use "${TempData}/04MainOutcomesInEventStudies.dta", clear 

bysort SubFunc YearMonth: egen SizeSF = count(IDlse)

generate one = 1 
collapse (mean) ChangeSalaryGrade TransferSJ SizeSF (sum) counts=one, by(SubFunc)

*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? step 2. average monthly lateral move rates across subfunctions
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

summarize TransferSJ [weight=SizeSF], detail
    local med = r(p50)
    local p25 = r(p25)
    local p75 = r(p75)
    local p99 = r(p99) // .1433902
twoway scatter TransferSJ SubFunc [weight=SizeSF] if TransferSJ<`p99' ///
    , legend(off) mcolor(ebblue) ///
    ylabel(0(0.025)0.15, grid gstyle(dot)) ytitle("") ///
    yline(`p25', lcolor(red)) text(0.012 150 "p25") ///
    yline(`p75', lcolor(red)) text(0.035 150 "p75") ///
    xtitle("Sub-function", size(medlarge)) ///
    title("Average monthly probability of job transfer", size(medlarge))

graph export "${Results}/AvgLateralMoveRatesAcrossSubfunctions.pdf", replace as(pdf)


*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??
*?? step 3. average monthly salary grade increase rates across subfunctions
*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??*??

summarize ChangeSalaryGrade [weight=SizeSF], detail
    local med = r(p50)
    local p25 = r(p25)
    local p75 = r(p75)
    local p99 = r(p99)

twoway scatter ChangeSalaryGrade SubFunc [weight=SizeSF] if ChangeSalaryGrade<`p99' ///
    , legend(off) mcolor(ebblue) ///
    ylabel(0(0.005)0.03, grid gstyle(dot)) ytitle("") ///
    yline(`p25', lcolor(red)) text(0.009 150 "p25") ///
    yline(`p75', lcolor(red)) text(0.018 150 "p75") ///
    xtitle("Sub-function", size(medlarge)) ///
    title("Average monthly probability of salary grade increase", size(medlarge))

graph export "${Results}/AvgSalaryGradeIncreaseRatesAcrossSubfunctions.pdf", replace as(pdf)


